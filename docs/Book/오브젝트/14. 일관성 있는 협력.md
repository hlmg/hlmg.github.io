# 14. 일관성 있는 협력

객체는 협력을 위해 존재한다. 협력은 객체가 존재하는 이유와 문맥을 제공한다.

잘 설계된 애플리케이션은 이해하기 쉽고, 수정이 용이하고, 재사용 가능한 협력의 모임이다.

객체지향 설계의 목표는 적절한 책임을 수행하는 객체들의 협력을 기반으로 결합도가 낮고 재사용 가능한 코드 구조를 창조하는 것이다.

일관성 있는 협력 패턴을 적용하면 이해하기 쉽고 유연한 코드를 얻을 수 있다.

## 일관성 없는 코드

공통의 목적을 구현하는 방식이 완전히 다른 여러 클래스가 있을 때 이 클래스들은 개념적으로는 연관돼 있지만 구현 방식에 있어서는 완전히 제각각이라고 할 수 있다.

비일관성은 두 가지 상황에서 발목을 잡는다.

1. 새로운 구현을 추가해야 하는 상황
    - 구현 방법을 결정하기 어렵다. 어떤 방식을 사용해도 기능 구현에는 문제가 없기 때문
2. 기존 구현을 이해해야 하는 상황
    - 구현 간 연관이 없기 때문에, 하나의 구현을 이해해도 다른 구현을 이해하는 데 도움이 되지 않는다.

유사한 기능을 서로 다른 방식으로 구현하면 안 된다. 일관성 없는 설계를 마주한 개발자는 여러 가지 해결 방법 중 현재의 요구사항을 해결하기에 가장 적절한 방법을 찾아야하는 부담을 안게 된다.

유사한 기능은 유사한 방식으로 구현해야 한다. 객체지향에서 기능을 구현하는 유일한 방법은 객체 사이의 협력을 만드는 것이므로 유지보수 가능한 시스템을 구축하는 첫걸음은 협력을 일관성 있게 만드는 것이다.

## 02. 설계에 일관성 부여하기

일관성 있는 설계를 만드는 방법

- 다양한 설계 경험을 익혀라
- 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 디자인 패턴을 적용해라

협력을 일관성 있게 만들기 위한 지침

- 변하는 개념을 변하지 않는 개념으로부터 분리하라.
- 변하는 개념을 캡슐화하라.

### 조건 로직 대 객체 탐색

객체지향적인 코드는 조건을 판단하지 않는다. 단지 다음 객체로 이동할 뿐이다.

조건 로직을 객체 사이의 이동으로 대체하기 위해서는 커다란 클래스를 작은 클래스들로 분리해야 한다. 그렇다면 클래스를 분리하기 위해 어떤 기준을 따르는 것이 좋을까?

가장 중요한 기준은 변경의 이유와 주기다. 클래스는 명확히 단 하나의 이유에 의해서만 변경되야 하고 클래스 안의 모든 코드는 함께 변경돼야 한다. 즉, 단일 책임 원칙을 따라야 한다.

> 구성 요소를 캡슐화하는 실행 지침은 객체지향의 핵심 덕목 중 하나다, 시스템을 책임을 캡슐화한 섬들로 분리하고 그 섬들 간의 결합도를 제한하라.

### 캡슐화 다시 살펴보기

캡슐화는 단순히 데이터 은닉을 하는 게 아니다. GoF 디자인 패턴에 다음 문구가 있다.

> 설계에서 무엇이 변화될 수 있는지 고려하라. 이 접근법은 재설계의 원인에 초점을 맞추는 것과 반대되는 것이다. 설계에 변경을 강요하는 것이 무엇인지에 대해 고려하기보다는 재설계 없이 변경할 수 있는 것이 무엇인지
> 고려하라. 여기서의 초점은 많은 디자인 패턴의 주체인 변화하는 개념을 캡슐화하는 것이다.

즉, 캡슐화는 소프트웨어 안에서 변할 수 있는 모든 '개념'을 감추는 것이다.

캡슐화의 대표적인 예는 인터페이스와 구현을 분리하는 것이다. 자주 변경되는 내부 구현을 안정적인 퍼블릭 인터페이스 뒤로 숨겨야 한다.

#### 다양한 종류의 캡슐화

- 데이터 캡슐화: 내부에 관리하는 데이터를 캡슐화하는 것
- 메서드 캡슐화: 클래스 내부와 서브클래스에서만 접근이 가능한 것, 클래스 내부 행동을 캡슐화하는 것이다.
- 객체 캡슐화: 객체와 객체 사이의 관계를 캡슐화하는 것, 합성을 의미한다.
- 서브타입 캡슐화: 기반 클래스가 서브타입 종류를 캡슐화하는 것, 다형성의 기반이다.

## 03. 일관성 있는 기본 정책 구현하기

변경을 캡슐화해서 협력을 일관성 있게 만들면 다음 장점을 얻을 수 있다.

- 변하지 않는 부분을 재사용할 수 있다.
- 새로운 기능을 추가할 때 변하는 부분만 구현하면 되기 때문에 원하는 기능을 쉽게 만들 수 있다.
    - 코드의 재사용성이 향상되고 테스트해야 하는 코드의 양이 감소한다.
- 따라야 하는 구조를 강제할 수 있어서 설계의 일관성이 무너지지 않는다.
- 하나의 구현체를 이해하면 다른 코드를 이해하는 데 도움이 된다.

유사한 기능에 유사한 협력 패턴을 적용하는 것은 객체지향 시스템에서 개념적 무결성(일관성)을 유지할 수 이는 가장 효과적인 방법이다.

:::tip 지속적으로 개선하라
일관성있는 협력 패턴이 요구사항이 추가되는 과정에서 일관성이 깨지기도 한다. 협력은 고정된 것이 아니다. 현재의 패턴이 변경을 수용할 수 있는 능력이 부족하다면 과감하게 리팩터링하라. 요구사항에 따라 협력도
지속적으로 개선해야 한다.
:::
